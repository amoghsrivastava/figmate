<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@700&display=swap" rel="stylesheet" />

<style>
  body {
    background-color: #1e1e1e;
    margin: 0;
    font-family: Inter, Helvetica, Arial, sans-serif;
    color: white;
    -webkit-user-select: none;
    /* Safari */
    -ms-user-select: none;
    /* IE 10 and IE 11 */
    user-select: none;
    /* Standard syntax */
  }

  .container {
    padding: 20px;
    background: #1e1e1e;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    gap: 20px;
    display: flex;
  }

  .section {
    align-self: stretch;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    gap: 8px;
    display: flex;
  }

  .title {
    align-self: stretch;
    color: white;
    font-size: 20px;
    line-height: 100%;
    font-family: "Space Grotesk", Inter, Helvetica, Arial, sans-serif;
    font-weight: 600;
    /* text-align: center; */
  }

  .description {
    align-self: stretch;
    color: rgba(255, 255, 255, 0.4);
    font-size: 12px;
  }

  .option {
    align-self: stretch;
    cursor: pointer;
    padding: 12px;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 6px;
    justify-content: flex-start;
    align-items: center;
    gap: 0px;
  }

  .option:hover {
    background: rgba(255, 255, 255, 0.15);
  }

  .option:active {
    background: rgba(255, 255, 255, 0.5);
  }

  .option-text {
    flex: 1 1 0;
    color: white;
    font-size: 12px;
    font-weight: 500;
  }

  .option-example {
    flex: 1 1 0;
    color: rgba(255, 255, 255, 0.4);
    font-size: 12px;
    font-weight: 400;
    text-align: left;
  }

  .suggested-tag {
    position: absolute;
    right: 12px;
    top: 18px;
    padding: 4px 8px;
    background: rgb(208, 255, 0);
    border-radius: 24px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .suggested-text {
    font-size: 10px;
    color: #1e1e1e;
  }

  .text-link-primary {
    cursor: pointer;
    color: white;
    font-size: 12px;
    font-weight: 500;
  }

  .text-link-primary:hover {
    color: rgba(255, 255, 255, 0.578);
  }

  .text-link-secondary {
    cursor: pointer;
    color: rgba(255, 255, 255, 0.4);
    font-size: 12px;
    font-weight: 400;
  }

  .text-link-secondary:hover {
    color: rgba(255, 255, 255, 0.2);
  }

  a {
    text-decoration: none;
  }

  .tabs {
    display: flex;
    gap: 6px;

  }

  .tab-button {
    cursor: pointer;
    color: rgba(255, 255, 255, 0.7);
    font-size: 12px;
    line-height: 16px;
    font-weight: 400;
    padding: 8px 12px;
    border-radius: 24px;
    /* border: 1px solid rgba(255, 255, 255, 0.1); */
    background-color: rgba(255, 255, 255, 0.05);
  }

  .tab-button:hover {
    background-color: rgba(255, 255, 255, 0.15);
  }

  .tab-button.active {
    color: #1e1e1e;
    background-color: rgb(255, 255, 255);
  }

  .tab-content {
    display: none;
    align-self: stretch;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
  }

  .tab-content.active {
    display: flex;
    align-self: stretch;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
  }

  .footer {
    position: fixed;
    left: 24px;
    bottom: 24px;
    display: flex;
    align-self: stretch;
    flex-direction: row;
    justify-content: space-between;
    align-items: flex-start;
    gap: 16px;
    background-color: #1e1e1e;
  }

  .list-view {
    display: flex;
    align-self: stretch;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    gap: 8px;
  }

  .grid-container {
    display: grid;
    /* grid-template-columns: repeat(auto-fit, minmax(52px, 1fr)); */
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
  }

  .grid-item {
    height: 62px;
    width: 62px;
    display: block;
    border-radius: 6px;
    background-color: #f5f5f5;
  }

  .grid-item img {
    max-width: 100%;
    height: 100%;
    cursor: pointer;
    object-fit: cover;
    border-radius: 6px;
  }

  .loading-indicator {

    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
    width: 24px;
    height: 24px;
    border: 2px solid #ffffff4a;
    border-bottom-color: transparent;
    border-radius: 50%;
    display: inline-block;
    box-sizing: border-box;
    animation: rotation 1s linear infinite;
  }

  @keyframes rotation {
    0% {
      transform: rotate(0deg);
    }

    100% {
      transform: rotate(360deg);
    }
  }
</style>

<div class="container">
  <div class="section">
    <div class="description">1.0.0</div>
    <div class="title">figmate</div>
    <div style="height: 0.5px; width: 100%; background-color: #404040; margin-top: 8px;"></div>

  </div>
  <div class="tabs" id="tabs">
    <div class="tab-button active" data-tab="case">Case</div>
    <div class="tab-button" data-tab="text-content">Text content</div>
    <div class="tab-button" data-tab="visual-content">Visual content</div>
  </div>

  <div class="tab-content active" id="case">
    <div class="section">
      <div class="option" id="submit-lower">
        <div class="option-text">Lower case</div>
        <div class="option-example">something like this</div>
      </div>
      <div class="option" id="submit-sentence" style="position: relative">
        <div class="suggested-tag">
          <div class="suggested-text">Suggested</div>
        </div>
        <div class="option-text">Sentence case</div>
        <div class="option-example">Something like this</div>
      </div>
      <div class="option" id="submit-title">
        <div class="option-text">Title case</div>
        <div class="option-example">Something Like This</div>
      </div>
      <div class="option" id="submit-upper">
        <div class="option-text">Upper case</div>
        <div class="option-example" style="text-transform: uppercase">
          SOMETHING LIKE THIS
        </div>
      </div>
    </div>
  </div>

  <div class="tab-content" id="text-content">
    <div class="section">
      <div class="option" id="vendor-name">
        <div class="option-text">Vendor names</div>
        <div class="option-example">Burger King, KFC, etc.</div>
      </div>
    </div>
  </div>

  <div class="tab-content" id="visual-content">
    <div class="list-view" id="list-view">

      <div class="option">
        <a href="#" onclick="showGridView('menu')">
          <div class="option-text">Menu items</div>
          <div class="option-example">Focusing on pizzas</div>
        </a>
      </div>


      <div class="option">
        <a href="#" onclick="showGridView('product')">
          <div class="option-text">QC products</div>
          <div class="option-example">Grocery items</div>
        </a>
      </div>


      <div class="option">
        <a href="#" onclick="showGridView('branding')">
          <div class="option-text">Branding</div>
          <div class="option-example">Marketing and branding imagery</div>
        </a>
      </div>
    </div>
    </a>
  </div>

  <div id="grid-view" class="grid-view" style="margin-top: -12px;">
    <div class="text-link-primary" onclick="showListView()" style="margin-top: 0px; margin-bottom: 24px; display: none;"
      id="back-to-list-view">
      ‚Üê Back
    </div>
    <div id="grid-container" class="grid-container">
      <!-- Images will be dynamically loaded here -->
    </div>
    <div id="loading-indicator" class="loading-indicator" style="display: none;">
    </div>

  </div>
</div>
</div>

<footer class="footer">
  <!-- <div class="text-link-primary" id="insert-meme">Get a meme (NSFW) </div> -->
  <div style="display: flex; flex-direction: row; gap: 16px">
    <a href="https://docs.google.com/document/d/1-O0Ok7AslwSvIlJmi9g-eHIlFjvRbqgyUthj_5VUeZA/edit#heading=h.rna5p5wafgim"
      target="_blank">
      <div class="text-link-secondary" id="about">Content Guide</div>
    </a>
    <div class="text-link-secondary" id="feedback">Send feedback</div>
  </div>
</footer>

<script>

  // Your album ID
  const CLIENT_ID = "3a40b4ddfa03e85";
  const ALBUM_IDS = {
    menu: "RaqWaZL", // Replace with actual album ID
    product: "N69Kold", // Replace with actual album ID
    branding: "djyqwSd", // Replace with actual album ID
  };

  async function showGridView(category) {
    try {
      const albumId = ALBUM_IDS[category];
      if (!albumId) {
        throw new Error("Invalid category");
      }

      // Hide the list view
      document.getElementById("list-view").style.display = "none";
      // Show loading indicator
      document.getElementById("loading-indicator").style.display = "block";

      // Fetch images for the selected category
      const images = await fetchImages(albumId);

      // Hide loading indicator after images are fetched
      document.getElementById("loading-indicator").style.display = "none";


      document.getElementById("tabs").style.display = "none";
      // Show the back button
      document.getElementById("back-to-list-view").style.display = "block";

      // Show the grid view
      const gridView = document.getElementById("grid-view");
      gridView.style.display = "block";

      // Clear previous grid items
      const gridContainer = document.getElementById("grid-container");
      gridContainer.innerHTML = "";

      // Build grid items dynamically
      images.forEach((image) => {
        const gridItem = document.createElement("div");
        gridItem.classList.add("grid-item");

        const img = document.createElement("img");
        img.src = image.link; // Assuming each image object has a 'link' property
        img.onclick = () => {
          parent.postMessage({ pluginMessage: { type: 'image-click', url: img.src } }, '*');
        };

        gridItem.appendChild(img);
        gridContainer.appendChild(gridItem);
      });
    } catch (error) {
      console.error("Error displaying grid view:", error);
      // Hide loading indicator if there's an error
      document.getElementById("loading-indicator").style.display = "none";
    }
  }



  function showListView() {
    // Hide the grid view
    document.getElementById("grid-view").style.display = "none";
    document.getElementById("tabs").style.display = "flex";
    // Show the list view
    document.getElementById("list-view").style.display = "flex";
  }

  async function fetchImages(albumId) {
    try {
      const response = await fetch(
        `https://api.imgur.com/3/album/${albumId}/images`,
        {
          headers: {
            Authorization: `Client-ID ${CLIENT_ID}`,
          },
        }
      );
      if (!response.ok) {
        throw new Error("Failed to fetch images");
      }
      const data = await response.json();
      return data.data; // Array of image objects
    } catch (error) {
      console.error("Error fetching images:", error);
      return [];
    }
  }

  document.addEventListener("DOMContentLoaded", function () {
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabContents = document.querySelectorAll(".tab-content");

    tabButtons.forEach((button) => {
      button.addEventListener("click", () => {
        const tab = button.getAttribute("data-tab");

        // Remove active class from all buttons and contents
        tabButtons.forEach((btn) => btn.classList.remove("active"));
        tabContents.forEach((content) => content.classList.remove("active"));

        // Add active class to the clicked button and corresponding content
        button.classList.add("active");
        document.getElementById(tab).classList.add("active");
      });
    });
  });

  document
    .getElementById("vendor-name")
    .addEventListener("click", vendorNameData, false);

  function vendorNameData() {
    parent.postMessage({ pluginMessage: { type: "vendor-name-data" } }, "*");
  }

  const options = document.querySelectorAll(".option");

  options.forEach((option) => {
    option.onclick = () => {
      parent.postMessage({ pluginMessage: { type: option.id } }, "*");
    };
  });

  document.getElementById("insert-meme").addEventListener("click", () => {
    parent.postMessage({ pluginMessage: { type: "addMeme" } }, "*");
  });

  onmessage = (event) => {
    const message = event.data.pluginMessage;

    if (message.type === "no-selection") {
      alert("Please select a text box on the canvas.");
    }
  };
</script>